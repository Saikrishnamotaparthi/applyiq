<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ApplyIQ - Premium Resume Analyzer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* CSS is mostly unchanged, with fixes for the gauge */
        :root {
            --bg-color: #0D1117;
            --surface-color: rgba(22, 27, 34, 0.75);
            --primary-accent: #58A6FF;
            --primary-accent-hover: #79c0ff;
            --danger-accent: #F85149;
            --danger-accent-hover: #ff6a64;
            --text-color: #e6edf3;
            --text-muted: #848d97;
            --border-color: rgba(139, 148, 158, 0.3);
            --success-color: #3FB950;
            --warn-color: #D29922;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-color) url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23161B22" fill-opacity="0.4"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
            color: var(--text-color);
            padding: 40px 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            backdrop-filter: blur(3px);
        }

        .hidden {
            display: none !important;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 24px;
            padding: 48px;
            box-shadow: 0 16px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #user-info-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.95rem;
        }

        #user-info-bar .left-content {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-muted);
        }

        .auth-button {
            background-color: transparent;
            color: var(--text-muted);
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        #loginButton:hover {
            color: var(--primary-accent);
            border-color: var(--primary-accent);
        }

        #logoutButton {
            color: var(--danger-accent);
            border-color: var(--danger-accent);
        }

        #logoutButton:hover {
            background-color: var(--danger-accent);
            color: #fff;
        }

        h1 {
            text-align: center;
            margin-bottom: 12px;
            font-size: 3rem;
            font-weight: 700;
            letter-spacing: -1.5px;
        }

        .subtitle {
            text-align: center;
            color: var(--text-muted);
            margin-bottom: 48px;
            font-size: 1.15rem;
        }

        .upload-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .file-input-wrapper {
            position: relative;
            background-color: rgba(13, 17, 23, 0.5);
            border: 2px dashed var(--border-color);
            border-radius: 16px;
            padding: 32px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .file-input-wrapper:hover,
        .file-input-wrapper.dragover {
            border-color: var(--primary-accent);
            box-shadow: 0 0 15px rgba(88, 166, 255, 0.2);
        }

        .upload-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 16px;
            transition: opacity 0.3s ease;
        }

        .file-loaded-view {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            transition: opacity 0.3s ease;
        }

        .upload-content.hidden,
        .file-loaded-view.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .upload-icon {
            color: var(--text-muted);
            transition: color 0.3s ease;
        }

        .file-input-wrapper:hover .upload-icon {
            color: var(--primary-accent);
        }

        .file-input-wrapper p {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .file-input-wrapper span {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .file-name {
            font-weight: 500;
            word-break: break-all;
            margin-bottom: 12px;
        }

        .remove-file-btn {
            background: none;
            border: 1px solid var(--danger-accent);
            color: var(--danger-accent);
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .remove-file-btn:hover {
            background: var(--danger-accent);
            color: #fff;
        }

        input[type="file"] {
            display: none;
        }

        #analyzeButton {
            width: 100%;
            padding: 18px;
            margin-top: 16px;
            font-size: 1.25rem;
            font-weight: 600;
            color: #fff;
            border: none;
            border-radius: 12px;
            background: linear-gradient(90deg, #4381e6, var(--primary-accent));
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(88, 166, 255, 0.15);
        }

        #analyzeButton:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(88, 166, 255, 0.25);
        }

        #analyzeButton:disabled {
            background: #21262d;
            color: var(--text-muted);
            cursor: not-allowed;
            transform: translateY(0);
            box-shadow: none;
            opacity: 0.6;
        }

        /* Results & Loading */
        #results {
            margin-top: 48px;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 5px solid var(--border-color);
            border-bottom-color: var(--primary-accent);
            border-radius: 50%;
            display: block;
            margin: 40px auto;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* --- GAUGE FIXES AND REDESIGN --- */
        .gauge-wrapper {
            width: 100%;
            max-width: 350px;
            margin: 0 auto;
            position: relative;
        }

        .gauge-wrapper svg {
            width: 100%;
            height: auto;
        }

        .gauge-arc {
            fill: none;
            stroke-width: 16;
            stroke-linecap: round;
        }

        /* Thinner stroke */
        .arc-track {
            stroke: var(--border-color);
        }

        /* FIX: Use a visible track color */
        .arc-score {
            stroke: url(#scoreGradient);
            stroke-dasharray: 251.2;
            stroke-dashoffset: 251.2;
            transition: stroke-dashoffset 1.5s ease-out;
        }

        .gauge-text {
            position: absolute;
            top: 55%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .gauge-score-value {
            font-size: 4rem;
            font-weight: 700;
            line-height: 1;
        }

        .gauge-score-label {
            font-size: 1rem;
            color: var(--text-muted);
            margin-top: 8px;
        }

        /* --- END GAUGE FIXES --- */

        .verdict-title {
            margin: 24px 0 12px;
            text-align: center;
            font-size: 1.75rem;
        }

        .verdict-reason {
            max-width: 600px;
            margin: 0 auto 40px;
            color: var(--text-muted);
            line-height: 1.6;
            text-align: center;
        }

        .analysis-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-top: 32px;
        }

        .analysis-box {
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 24px;
        }

        .analysis-box h3 {
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 12px;
            margin-bottom: 16px;
        }

        ul {
            list-style: none;
        }

        li {
            display: flex;
            gap: 12px;
            margin-bottom: 10px;
            align-items: flex-start;
            line-height: 1.5;
        }

        @media(max-width: 768px) {
            .container {
                padding: 32px 24px;
            }

            .upload-section {
                grid-template-columns: 1fr;
            }

            .analysis-details {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2.5rem;
            }

            .subtitle {
                font-size: 1rem;
            }
        }
    </style>
</head>

<body>
    <div id="app-container" class="container">
        <!-- HTML is unchanged -->
        <div id="user-info-bar">
            <div id="guest-view" class="left-content"><span id="guest-usage-text"></span></div>
            <button id="loginButton" class="auth-button">Admin Login</button>
            <div id="user-view" class="left-content hidden">
                <span id="welcome-message"></span><span>|</span><span>Usage: <b
                        style="color:var(--success-color);">Unlimited</b></span>
            </div>
            <button id="logoutButton" class="auth-button hidden">Logout</button>
        </div>
        <h1>ApplyIQ</h1>
        <p class="subtitle">Get an instant, data-driven analysis of your application.</p>
        <form id="analyzerForm">
            <div class="upload-section">
                <label for="resumeFile" class="file-input-wrapper">
                    <div class="upload-content">
                        <div class="upload-icon"><svg width="32" height="32" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                                <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                                <path d="M12 18V12" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                                <path d="M10 16L12 18L14 16" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg></div>
                        <p>Your Resume</p><span class="upload-hint">Click or Drag & Drop PDF</span>
                    </div>
                </label>
                <label for="jdFile" class="file-input-wrapper">
                    <div class="upload-content">
                        <div class="upload-icon"><svg width="32" height="32" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M15.5 2H8.5C7.57174 2 6.6815 2.36875 6.02513 3.02513C5.36875 3.6815 5 4.57174 5 5.5V18.5C5 19.4283 5.36875 20.3185 6.02513 20.9749C6.6815 21.6313 7.57174 22 8.5 22H15.5C16.4283 22 17.3185 21.6313 17.9749 20.9749C18.6313 20.3185 19 19.4283 19 18.5V5.5C19 4.57174 18.6313 3.6815 17.9749 3.02513C17.3185 2.36875 16.4283 2 15.5 2V2Z"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                                <path d="M12 18V12" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                                <path d="M10 16L12 18L14 16" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg></div>
                        <p>The Job Description</p><span class="upload-hint">Click or Drag & Drop PDF</span>
                    </div>
                </label>
                <input type="file" id="resumeFile" name="resumeFile" accept=".pdf" required>
                <input type="file" id="jdFile" name="jdFile" accept=".pdf" required>
            </div>
            <button type="submit" id="analyzeButton">Analyze Now</button>
        </form>
        <div id="results"></div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        // Firebase config and core logic is unchanged
        const firebaseConfig = {
            apiKey: "AIzaSyCM9JPDHFgWueiKtNP3Fbmh86hwDPn0wuw",
            authDomain: "applyiq-analyzer.firebaseapp.com",
            projectId: "applyiq-analyzer",
            storageBucket: "applyiq-analyzer.firebasestorage.app",
            messagingSenderId: "834531251443",
            appId: "1:834531251443:web:442374fd225f5b7b3ad386",
            measurementId: "G-YYY87KQMJ3"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const form = document.getElementById('analyzerForm');
        const resultsDiv = document.getElementById('results');
        const analyzeButton = document.getElementById('analyzeButton');
        const loginButton = document.getElementById('loginButton');
        const logoutButton = document.getElementById('logoutButton');
        const guestView = document.getElementById('guest-view');
        const userView = document.getElementById('user-view');
        const guestUsageText = document.getElementById('guest-usage-text');
        const welcomeMessage = document.getElementById('welcome-message');
        const N8N_WEBHOOK_URL = "http://api.applyiq.saikrishnamotaparthi.tech/webhook/c2965a19-d85e-4e77-b5b7-d9465d9b6c23";
        const GUEST_USES_PER_DAY = 2;
        let remainingGuestUses = 0;

        function checkGuestUsage() {
            const today = new Date().toISOString().split('T')[0];
            let guestData = JSON.parse(localStorage.getItem('applyIQGuestUsage') || '{}');
            if (guestData.date !== today) { guestData = { count: 0, date: today }; localStorage.setItem('applyIQGuestUsage', JSON.stringify(guestData)); }
            remainingGuestUses = GUEST_USES_PER_DAY - guestData.count;
            updateUI(null);
        }
        function incrementGuestUsage() {
            const today = new Date().toISOString().split('T')[0];
            let guestData = JSON.parse(localStorage.getItem('applyIQGuestUsage') || `{"count":0, "date":"${today}"}`);
            guestData.count++;
            localStorage.setItem('applyIQGuestUsage', JSON.stringify(guestData));
            remainingGuestUses = GUEST_USES_PER_DAY - guestData.count;
            updateUI(null);
        }
        async function isUserAuthorized(user) {
            if (!user) return false;
            const doc = await db.collection('allowedUsers').doc(user.uid).get();
            return doc.exists;
        }
        const googleProvider = new firebase.auth.GoogleAuthProvider();
        loginButton.addEventListener('click', () => auth.signInWithPopup(googleProvider).catch(err => console.error("Login Error:", err)));
        logoutButton.addEventListener('click', () => auth.signOut());
        auth.onAuthStateChanged(async user => {
            if (user) {
                const authorized = await isUserAuthorized(user);
                if (authorized) { updateUI(user); } else { alert('Access Denied. This Google account is not authorized.'); await auth.signOut(); }
            } else { updateUI(null); }
        });
        function updateUI(user) {
            if (user) {
                guestView.classList.add('hidden'); loginButton.classList.add('hidden');
                userView.classList.remove('hidden'); logoutButton.classList.remove('hidden');
                welcomeMessage.innerHTML = `Admin: <b>${user.displayName.split(' ')[0]}</b>`;
                analyzeButton.disabled = false; analyzeButton.textContent = "Analyze Now";
            } else {
                userView.classList.add('hidden'); logoutButton.classList.add('hidden');
                guestView.classList.remove('hidden'); loginButton.classList.remove('hidden');
                guestUsageText.innerHTML = `Free analyses remaining: <b>${remainingGuestUses}</b>`;
                analyzeButton.disabled = remainingGuestUses <= 0;
                analyzeButton.textContent = remainingGuestUses <= 0 ? "Daily Guest Limit Reached" : "Analyze Now";
            }
        }

        // UI interaction logic is unchanged and correct
        ['resume', 'jd'].forEach(type => {
            const fileInput = document.getElementById(`${type}File`);
            const wrapper = document.querySelector(`label[for="${type}File"]`);
            const defaultContent = wrapper.querySelector('.upload-content');
            fileInput.addEventListener('change', () => {
                let loadedView = wrapper.querySelector('.file-loaded-view');
                if (!loadedView) { loadedView = document.createElement('div'); loadedView.className = 'file-loaded-view hidden'; wrapper.appendChild(loadedView); }
                if (fileInput.files.length > 0) {
                    loadedView.innerHTML = `<div class="file-name">${fileInput.files[0].name}</div><button type="button" class="remove-file-btn">Remove</button>`;
                    defaultContent.classList.add('hidden'); loadedView.classList.remove('hidden');
                }
            });
            wrapper.addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-file-btn')) {
                    e.preventDefault(); e.stopPropagation(); fileInput.value = '';
                    wrapper.querySelector('.file-loaded-view').classList.add('hidden'); defaultContent.classList.remove('hidden');
                }
            });
            ['dragenter', 'dragover'].forEach(eventName => wrapper.addEventListener(eventName, (e) => { e.preventDefault(); wrapper.classList.add('dragover'); }, false));
            ['dragleave', 'drop'].forEach(eventName => wrapper.addEventListener(eventName, (e) => { e.preventDefault(); wrapper.classList.remove('dragover'); }, false));
        });

        // Form submission is unchanged
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const user = auth.currentUser;
            if (!user && remainingGuestUses <= 0) return;
            analyzeButton.disabled = true;
            analyzeButton.innerHTML = '<div class="loading-spinner" style="width:24px; height:24px; border-width:3px; margin: 0 auto;"></div>';
            resultsDiv.innerHTML = '';
            try {
                const formData = new FormData(form);
                const res = await fetch(N8N_WEBHOOK_URL, { method: 'POST', body: formData });
                if (!res.ok) throw new Error(`n8n error: ${res.statusText}`);
                const data = await res.json();
                if (!user) incrementGuestUsage();
                if (data.finalResponse) { displayResults(data.finalResponse); }
                else { throw new Error("Analysis completed, but no response data was found."); }
            } catch (err) {
                resultsDiv.innerHTML = `<p style="color:var(--danger-accent);text-align:center"><b>Error:</b> ${err.message}</p>`;
            } finally {
                updateUI(auth.currentUser);
            }
        });

        // --- CORRECTED displayResults FUNCTION ---
        function displayResults(data) {
            const { rating = 0, pros = [], cons = [], missingKeywords = [], isEligible = false, eligibilityReasoning = "N/A" } = data;
            const eligibilityText = isEligible ? 'Ideal Match' : 'Not an Ideal Match';
            const eligibilityColor = isEligible ? 'var(--success-color)' : 'var(--danger-accent)';

            // FIX: Added fill="none" to paths and updated the gauge text structure
            resultsDiv.innerHTML = `
                <div class="gauge-wrapper">
                    <svg viewBox="0 0 200 115">
                        <defs>
                            <linearGradient id="scoreGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" stop-color="var(--danger-accent)" />
                                <stop offset="50%" stop-color="var(--warn-color)" />
                                <stop offset="100%" stop-color="var(--success-color)" />
                            </linearGradient>
                        </defs>
                        <path class="gauge-arc arc-track" d="M 20,100 A 80,80 0 0,1 180,100" fill="none"></path>
                        <path class="gauge-arc arc-score" id="score-arc" d="M 20,100 A 80,80 0 0,1 180,100" fill="none"></path>
                    </svg>
                    <div class="gauge-text">
                        <div class="gauge-score-value">${rating}</div>
                        <div class="gauge-score-label">Match Score</div>
                    </div>
                </div>
                <h2 class="verdict-title" style="color:${eligibilityColor};">${eligibilityText}</h2>
                <p class="verdict-reason">${eligibilityReasoning}</p>
                <div class="analysis-details">
                    <div class="analysis-box pros"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="var(--success-color)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 8V16" stroke="var(--success-color)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 12H16" stroke="var(--success-color)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>Pros (Strengths)</h3><ul>${pros.map(p => `<li>✅ ${p}</li>`).join('') || '<li>None found.</li>'}</ul></div>
                    <div class="analysis-box cons"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="var(--danger-accent)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 12H16" stroke="var(--danger-accent)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>Cons (Gaps)</h3><ul>${cons.map(c => `<li>❌ ${c}</li>`).join('') || '<li>None found.</li>'}</ul></div>
                </div>
                <div class="analysis-box"><h3>Missing Keywords</h3><ul>${missingKeywords.map(k => `<li>- ${k}</li>`).join('') || '<li>None found.</li>'}</ul></div>`;

            // Animate gauge
            setTimeout(() => {
                const scoreArc = document.getElementById("score-arc");
                scoreArc.style.strokeDashoffset = 251.2 * (1 - (rating / 100));
            }, 100);
        }

        // Initialize App
        checkGuestUsage();
    </script>
</body>

</html>


